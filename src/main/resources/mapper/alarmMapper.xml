<?xml version="1.0" encoding="UTF-8"?> 
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.yanado.dao.AlarmDAO">
	<!-- alarm table -->

	<sql id="alarmColumns">
		alarmId,
		userId,
		typeId,
		type,
		price,
		message,
		sendDate,
		deadline
	</sql>

	<!-- sequence 이름 alarm_seq -->
	<!-- alarm 생성 -->
	<insert id="insertAlarm" parameterType="com.yanado.dto.Alarm">
		<selectKey keyProperty="id" resultType="String"
			order="BEFORE">
			SELECT
			alarm_seq.nextval From DUAL
		</selectKey>

		INSERT INTO alarm(
		<include refid="alarmColumns" />
		) VALUES ( #{id}, #{typeId}, #{type}, #{price}, #{message},
		SYSDATE, #{deadline}
		)
	</insert>

	<!-- alarm 읽기 -->
	<select id="findAlarmByAlarmId" parameterType="String"
		resultType="com.yanado.dto.Alarm">
		select * from alarm where alarmId = #{alarmId}
	</select>

	<!-- common alarm 찾기 -->
	<select id="findAlarmByCommonId" parameterType="String"
		resultType="com.yanado.dto.Alarm">
		select * from alarm where typeId = #{typeId} and type
		between 1 and 3
	</select>

	<!-- auction alarm 찾기 -->
	<select id="findAlarmByAuctionId" parameterType="String"
		resultType="com.yanado.dto.Alarm">
		select * from alarm where typeId = #{typeId} and type
		between 4 and 6
	</select>

	<!-- MyPage 관련 alarm -->
	<select id="findAllAlarmByUserId" parameterType="String"
		resultType="com.yanado.dto.Alarm">
		select * from ( select * from alarm c where typeId in
		(select commonId from commonJoin where userId = 'userId') UNION
		select
		* from alarm a where typeId in (select aucId from aucJoin where userId
		= 'userId') ) order by a.sendDate, b.sendDate
	</select>

</mapper>